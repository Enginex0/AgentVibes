# AgentVibes Development Progress Log

## Session: December 14, 2025 (MCP Default + Auto-Install)

### Summary
Made MCP the default TTS mode with zero-delay symlink switching. Added auto voice download to installer. Fixed uninstaller to clean all traces.

### What Was Done

1. **MCP as Default TTS Mode**
   - Created session-start-mcp-tts.sh with full features (verbosity, logging, style)
   - Renamed session-start-tts.sh to session-start-bash-tts.sh
   - session-start-tts.sh is now a symlink (kernel-resolved, zero overhead)
   - Installer auto-detects aggregator and sets appropriate symlink

2. **Updated MCP Server (server.py)**
   - Changed from old FIFO path to new file queue (~/.claude/piper-queue/)
   - Returns "⚡ MCP TTS via queue" when using fast path
   - Falls back to subprocess if queue not available

3. **Performance Testing**
   - Bash mode: ~160-290ms (avg ~202ms)
   - MCP mode: ~50-100ms
   - Raw queue write: ~0.3ms

4. **Installer Improvements (12 steps now)**
   - Step 9: Auto-download default voice model (60MB)
   - Step 12: Create TTS mode symlink based on aggregator
   - Simplified "Next steps" - most setup is automatic now

5. **Uninstaller Improvements**
   - Added: agentvibes-patches directory
   - Added: mcp-aggregator/servers/agentvibes cache
   - Added: agentvibes wrapper scripts
   - Added: agentvibes logs directory
   - Added: session-start-bash-tts.sh, tts-mode-toggle.sh hooks

6. **Toggle Script**
   - Created tts-mode-toggle.sh for manual mode switching
   - Usage: ./tts-mode-toggle.sh [mcp|bash|status]

### Commits Made This Session
```
3af067f3 fix(installer): Auto-download voice model + complete uninstall cleanup
abe795b0 feat(tts): MCP as default with zero-delay symlink switching
```

### Files Modified
- .claude/hooks/session-start-bash-tts.sh (renamed)
- .claude/hooks/session-start-mcp-tts.sh (full features)
- .claude/hooks/tts-mode-toggle.sh (NEW)
- mcp-server/server.py (file queue support)
- scripts/install-user-level.sh (+voice download, +12 steps)
- scripts/uninstall-user-level.sh (+7 cleanup items)

### Architecture

```
~/.claude/hooks/
├── session-start-bash-tts.sh     # Bash version (fallback)
├── session-start-mcp-tts.sh      # MCP version (default, faster)
└── session-start-tts.sh → symlink to one of above
```

Installer logic:
- If aggregator detected + MCP configured → symlink to MCP
- If no aggregator → symlink to Bash

### System Status
- All commits pushed to origin
- 29 commits ahead of upstream/master
- MCP mode is now default for new installs

### Previous Session (for context)
- Replaced FIFO with file-based queue (96% improvement)
- Executed 10 A+ audit fixes
- Final grades: A/A+/A-/A+
